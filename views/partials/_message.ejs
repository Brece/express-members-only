<!-- TODO: add delete button -->

<% if (message_list.length > 0) { %>
    <% for (const message of message_list) { %>
        <div class="c-message">
            <% if (user && ((user.status || user.admin) || (user._id.toString() === message.user._id.toString()))) { %>
                <p><%= message.user.fullname %></p>
                <p><%= message.createdAt_formatted %></p>
            <% } else { %>
                <p>Anonymous User</p>
                <p>Date: ???</p>
            <% } %>
            <p><%- message.title %></p>
            <p><%- message.text %></p>

            <% if (message.user.image.file !== undefined) { %>
                <img
                src="data:<%= message.user.image.file.contentType %>;base64,
                <%= message.user.image.file.data.toString('base64') %>"
                alt="<%= message.user.image.file.name %>"
                class="">
            <% } %>

            <% if (user && user.admin) { %>
                <form action="/user/<%= message.user._id %>/delete-message" method="POST">
                    <input type="hidden" name="messageid" value="<%= message._id %>">
                    <button type="submit" class="c-btn c-btn--delete">Delete</button>
                </form>
            <% } %> 
        </div>
    <% } %> 
<% } %> 